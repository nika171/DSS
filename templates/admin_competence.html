{% extends 'base.html' %}
{% block content %}
<div class="max-w-6xl mx-auto">
   <div class="p-4 border-2 border-gray-200 border-dashed rounded-lg dark:border-gray-700">
      
      <div class="mb-6 flex items-center justify-between">
         <div>
            <h5 class="mb-2 text-4xl font-bold tracking-tight text-[#2A4A6A] dark:text-white">
               Kompetenzen bearbeiten
            </h5>
            <p class="text-lg text-gray-600 dark:text-gray-400">
               Mitarbeiter: <span class="font-semibold text-gray-900 dark:text-white">{{ target_user.name }}</span>
            </p>
         </div>
      </div>

      <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg dark:bg-yellow-900 dark:border-yellow-700">
         <div class="flex items-start space-x-2">
            <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
               <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <div>
               <h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Fremdeinschätzung</h3>
               <p class="text-sm text-yellow-700 dark:text-yellow-300">
                  Sie bearbeiten die Kompetenzen eines Mitarbeiters. Änderungen sind für den Mitarbeiter in seinem Dashboard sichtbar.
               </p>
            </div>
         </div>
      </div>

      <form method="POST">
         {{ form.hidden_tag() }}

                <div id="accordion-competence-groups" data-accordion="collapse">
                {% for competence_group in competence_groups %}
                <h2 id="heading-competence-groups-{{ loop.index }}">
                    <button type="button" class="flex items-center justify-between w-full p-5 font-medium text-left text-black border border-[#2A4A6A] {% if not loop.last %}border-b-0{% endif %} hover:bg-gray-200" data-accordion-target="#body-category-{{ loop.index }}" aria-expanded="false" aria-controls="body-category-{{ loop.index }}">
                    {{ competence_group.name }}
                    <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 6">
                        <path stroke="currentColor" stroke-width="2" d="M9 5 5 1 1 5" />
                    </svg>
                    </button>
                </h2>
                    <div id="body-category-{{ loop.index }}" class="hidden" aria-labelledby="heading-category-{{ loop.index }}">
                <div class="p-5 border border-[#2A4A6A] {% if not loop.last %}border-b-0{% endif %}">

                    <div id="accordion-competence-groups-{{ loop.index }}" data-accordion="collapse">
                    {% for competence in competence_group.competences %}
                        <h3 id="heading-competence-{{ loop.index }}-{{ loop.index0 }}">
                        <button type="button"
                                class="flex items-center justify-between w-full p-4 font-medium text-left text-[#2A4A6A] border border-[#2A4A6A] {% if not loop.last %}border-b-0{% endif %} hover:bg-gray-100"
                                data-accordion-target="#body-competence-{{ competence_group.id }}-{{ competence.id }}"
                                aria-expanded="false"
                                aria-controls="body-competence-{{ competence_group.id }}-{{ competence.id }}">
                            {{ competence.name }}
                            <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 6">
                            <path stroke="currentColor" stroke-width="2" d="M9 5 5 1 1 5" />
                            </svg>
                        </button>
                        </h3>

                        <div id="body-competence-{{ competence_group.id }}-{{ competence.id }}" class="hidden" aria-labelledby="heading-group-{{ loop.index }}-{{ loop.index0 }}">
                        <div class="p-4 border border-[#2A4A6A] {% if not loop.last %}border-b-0{% endif %} bg-white">
                            <table class="w-full text-sm text-left text-gray-700">
                            <thead class="text-xs uppercase bg-[#2A4A6A] text-white">
                                <tr>
                                <th class="px-6 py-3">Kompetenz</th>
                                <th class="px-6 py-3">Kenner</th>
                                <th class="px-6 py-3">Könner</th>
                                <th class="px-6 py-3">Experte</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for knowledge_skill in competence.knowledge_skills %}
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4">{{ knowledge_skill.name }}</td>
                                    <td class="px-6 py-4">
                                        <input type="radio" 
                                               name="kompetenzen[{{ knowledge_skill.id }}]" 
                                               value="Kenner"
                                               id="kenner_{{ knowledge_skill.id }}"
                                               {% if current_competences.get(knowledge_skill.id) == 'Kenner' %}checked{% endif %}>
                                    </td>
                                    <td class="px-6 py-4">
                                        <input type="radio" 
                                               name="kompetenzen[{{ knowledge_skill.id }}]" 
                                               value="Könner"
                                               id="koenner_{{ knowledge_skill.id }}"
                                               {% if current_competences.get(knowledge_skill.id) == 'Könner' %}checked{% endif %}>
                                    </td>
                                    <td class="px-6 py-4">
                                        <input type="radio" 
                                               name="kompetenzen[{{ knowledge_skill.id }}]" 
                                               value="Experte"
                                               id="experte_{{ knowledge_skill.id }}"
                                               {% if current_competences.get(knowledge_skill.id) == 'Experte' %}checked{% endif %}>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            </table>                                          
                        </div>
                        </div>
                    {% endfor %}
                    </div>
                </div>
                </div>
            {% endfor %}
                                    
         <div class="flex justify-center items-center space-x-4 mt-8">
            <button type="submit" 
                    class="text-white bg-[#2A4A6A] hover:bg-blue-800 focus:ring-4 focus:outline-none 
                           focus:ring-blue-300 font-medium rounded-lg text-sm px-8 py-3 
                           dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
               Kompetenzen speichern
            </button>
            
            <a href="{{ url_for('admin_user_management') }}">
               <button type="button" 
                       class="text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 
                              focus:ring-4 focus:outline-none focus:ring-gray-200 font-medium rounded-lg 
                              text-sm px-8 py-3 dark:bg-gray-800 dark:text-white dark:border-gray-600 
                              dark:hover:bg-gray-700 dark:hover:border-gray-600 dark:focus:ring-gray-700">
                  Abbrechen
               </button>
            </a>
         </div>
      </form>
   </div>
</div>      
{% endblock %}
